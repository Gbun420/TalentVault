(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,49824,(e,s,t)=>{"use strict";var a=e.r(86577).__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;t.c=function(e){return a.H.useMemoCache(e)}},93120,(e,s,t)=>{"use strict";s.exports=e.r(49824)},91338,e=>{"use strict";var s=e.i(29584),t=e.i(93120),a=e.i(86577),l=e.i(30389);e.i(75470);var i=e.i(45825);let n=[{label:"Any",value:""},{label:"0-2 years",value:"0-2"},{label:"3-5 years",value:"3-5"},{label:"6-10 years",value:"6-10"},{label:"10+ years",value:"10+"}];function r(){let[e,t]=(0,a.useState)(""),[r,d]=(0,a.useState)(""),[o,u]=(0,a.useState)(""),[m,p]=(0,a.useState)(""),[x,h]=(0,a.useState)(""),[b,j]=(0,a.useState)(""),[N,g]=(0,a.useState)(!0),[y,v]=(0,a.useState)([]),[f,w]=(0,a.useState)(new Set),[k,_]=(0,a.useState)(null),[S,C]=(0,a.useState)(null),[T,U]=(0,a.useState)(null),[E,P]=(0,a.useState)(null),A=async()=>{g(!0),await Promise.all([L(),O(),R()]),g(!1)},O=async()=>{try{let e=l.auth.currentUser;if(!e)return;let s=(0,i.query)((0,i.collection)(l.db,"unlocked_contacts"),(0,i.where)("employer_id","==",e.uid)),t=await (0,i.getDocs)(s),a=new Set(t.docs.map(e=>e.data().jobseeker_id));w(a)}catch(e){console.error("Error fetching unlocks:",e)}},R=async()=>{try{let e=l.auth.currentUser;if(!e)return;let s=(0,i.query)((0,i.collection)(l.db,"employer_subscriptions"),(0,i.where)("employer_id","==",e.uid),(0,i.orderBy)("updated_at","desc"),(0,i.limit)(1)),t=await (0,i.getDocs)(s);if(!t.empty){let e=t.docs[0].data(),s={plan_code:e.plan_code,status:e.status,current_period_end:e.current_period_end??null};U(s)}}catch(e){console.error("Error fetching subscription:",e)}},L=async()=>{P(null);try{let s=[];if(e.trim()){let t=e.split(",").map(e=>e.trim()).filter(Boolean);t.length&&s.push((0,i.where)("skills","array-contains-any",t))}if(r.trim()&&s.push((0,i.where)("preferred_roles","array-contains",r.trim())),m.trim()&&s.push((0,i.where)("availability","==",m.trim())),x.trim()&&s.push((0,i.where)("location","==",x.trim())),b.trim()&&s.push((0,i.where)("work_permit_status","==",b.trim())),o){let[e,t]="10+"===o?[10,null]:o.split("-").map(Number);void 0!==e&&s.push((0,i.where)("years_experience",">=",e)),null!==t&&s.push((0,i.where)("years_experience","<=",t))}s.push((0,i.where)("moderation_status","==","approved")),s.push((0,i.where)("visibility","in",["public","employers_only"])),s.push((0,i.limit)(50));let t=(0,i.query)((0,i.collection)(l.db,"jobseeker_profiles"),...s),a=(await (0,i.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}));v(a)}catch(e){P(e instanceof Error?e.message:"Something went wrong"),v([])}},D=async e=>{_(e),P(null);let s=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"unlock",jobseekerId:e})}),t=await s.json();if(!s.ok){P(t.error||"Failed to unlock contact"),_(null);return}if(t.alreadyUnlocked){let s=new Set(f);s.add(e),w(s),_(null);return}if(t.url){window.location.href=t.url;return}_(null)};(0,a.useEffect)(()=>{A()},[]);let B=async e=>{C(e),P(null);let s=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"subscription",subscriptionType:e})}),t=await s.json();if(!s.ok){P(t.error||"Failed to start subscription checkout"),C(null);return}t.url?window.location.href=t.url:C(null)},F=async e=>{let s=await fetch("/api/unlock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobseekerId:e})}),t=await s.json();if(s.ok){let s=new Set(f);return s.add(e),w(s),_(null),!0}return 402!==s.status&&(P(t.error||"Failed to unlock contact"),_(null),null)};return N?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"card p-6 animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-slate-200 rounded w-1/4 mb-4"}),(0,s.jsx)("div",{className:"h-4 bg-slate-200 rounded w-1/2"})]}),(0,s.jsxs)("div",{className:"card p-6 animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-slate-200 rounded w-1/4 mb-4"}),(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,s.jsx)("div",{className:"h-10 bg-slate-200 rounded"}),(0,s.jsx)("div",{className:"h-10 bg-slate-200 rounded"}),(0,s.jsx)("div",{className:"h-10 bg-slate-200 rounded"})]})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"card p-5 animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-slate-200 rounded w-3/4 mb-2"}),(0,s.jsx)("div",{className:"h-4 bg-slate-200 rounded w-1/2"})]}),(0,s.jsxs)("div",{className:"card p-5 animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-slate-200 rounded w-3/4 mb-2"}),(0,s.jsx)("div",{className:"h-4 bg-slate-200 rounded w-1/2"})]})]})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"card p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Access options"}),(0,s.jsx)("p",{className:"text-sm text-slate-600",children:"Choose a subscription or pay-per-unlock. Limited plans include a fixed number of unlocks; unlimited provides full monthly access."}),(0,s.jsxs)("div",{className:"mt-4 flex flex-wrap gap-3",children:[(0,s.jsx)("button",{onClick:()=>B("limited"),disabled:null!==S,className:"btn btn-primary",children:"limited"===S?"Redirecting...":"Subscribe (Limited unlocks)"}),(0,s.jsx)("button",{onClick:()=>B("unlimited"),disabled:null!==S,className:"btn btn-secondary",children:"unlimited"===S?"Redirecting...":"Subscribe (Unlimited)"}),(0,s.jsx)("p",{className:"text-xs text-slate-600",children:"You can still pay-per-unlock on each Profile card if you prefer."})]}),T?(0,s.jsxs)("p",{className:"mt-2 text-xs text-green-700",children:["Active subscription: ",T.plan_code," (",T.status,")"]}):(0,s.jsx)("p",{className:"mt-2 text-xs text-slate-600",children:"No active subscription detected."})]}),(0,s.jsxs)("div",{className:"card p-6",children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-slate-900",children:"Search Profiles"}),(0,s.jsx)("p",{className:"text-sm text-slate-600",children:"Search local Profiles. Names and contact are blurred until unlocked."}),(0,s.jsxs)("div",{className:"mt-4 grid gap-3 md:grid-cols-3",children:[(0,s.jsx)(c,{label:"Skills (comma separated)",children:(0,s.jsx)("input",{className:"input",value:e,onChange:e=>t(e.target.value),placeholder:"e.g., React, Node, SQL"})}),(0,s.jsx)(c,{label:"Role / function",children:(0,s.jsx)("input",{className:"input",value:r,onChange:e=>d(e.target.value),placeholder:"e.g., Frontend Developer"})}),(0,s.jsx)(c,{label:"Location",children:(0,s.jsx)("input",{className:"input",value:x,onChange:e=>h(e.target.value),placeholder:"e.g., City, Country"})}),(0,s.jsx)(c,{label:"Availability",children:(0,s.jsx)("input",{className:"input",value:m,onChange:e=>p(e.target.value),placeholder:"Immediately"})}),(0,s.jsx)(c,{label:"Work permit",children:(0,s.jsx)("input",{className:"input",value:b,onChange:e=>j(e.target.value),placeholder:"e.g., EU Citizen, Work Permit"})}),(0,s.jsx)(c,{label:"Experience",children:(0,s.jsx)("select",{className:"input",value:o,onChange:e=>u(e.target.value),children:n.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})})]}),(0,s.jsxs)("div",{className:"mt-4 flex gap-3",children:[(0,s.jsx)("button",{onClick:L,disabled:N,className:"btn btn-primary",children:N?"Searching...":"Search"}),(0,s.jsx)("button",{onClick:()=>{t(""),d(""),u(""),p(""),h(""),j(""),L()},className:"btn btn-secondary",children:"Clear filters"})]}),E?(0,s.jsx)("p",{className:"mt-2 text-sm text-red-600",children:E}):null]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[0!==y.length||N?null:(0,s.jsx)("p",{className:"text-sm text-slate-600",children:"No Profiles match these filters yet."}),y.map(e=>{var t;let a=f.has(e.id),l=(t=e.full_name,a?t:t?t.split(" ").filter(Boolean).map(e=>e[0]+"•••").join(" "):"Hidden"),i=null!=e.years_experience?`${e.years_experience} yrs`:"N/A";return(0,s.jsxs)("div",{className:"card space-y-3 p-5",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-500",children:l}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:e.headline}),a?(0,s.jsx)("span",{className:"badge bg-green-100 text-green-700",children:"Unlocked"}):(0,s.jsx)("span",{className:"badge bg-slate-200 text-slate-700",children:"Locked"})]}),(0,s.jsxs)("div",{className:"text-right",children:[a?(0,s.jsx)("span",{className:"text-xs font-semibold text-green-700",children:"Contact available"}):(0,s.jsx)("button",{onClick:async()=>{if(_(e.id),T?.status==="active"){let s=await F(e.id);if(!0===s||null===s)return}await D(e.id)},disabled:k===e.id,className:"btn btn-primary text-xs",children:k===e.id?"Unlocking...":"Unlock contact"}),a?null:(0,s.jsx)("p",{className:"mt-1 text-[11px] text-slate-600",children:"Paid unlock or active subscription"})]})]}),(0,s.jsx)("p",{className:"text-sm text-slate-700 line-clamp-3",children:e.summary}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:e.skills?.slice(0,8).map(e=>(0,s.jsx)("span",{className:"badge",children:e},e))}),(0,s.jsxs)("div",{className:"grid gap-2 text-xs text-slate-600 sm:grid-cols-3",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-semibold text-slate-800",children:"Experience:"})," ",i]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-semibold text-slate-800",children:"Availability:"})," ",e.availability||"Unknown"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-semibold text-slate-800",children:"Location:"})," ",e.location||"Not specified"]})]}),(0,s.jsxs)("p",{className:"text-xs text-slate-600",children:[(0,s.jsx)("span",{className:"font-semibold text-slate-800",children:"Work permit:"})," ",e.work_permit_status||"Unknown"]}),a?(0,s.jsx)("p",{className:"text-xs text-green-700",children:"Contact unlocked. View details on the candidate page."}):(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Contact details are locked until you unlock or use your subscription."})]},e.id)})]})]})}function c(e){let a,l=(0,t.c)(3),{label:i,children:n}=e;return l[0]!==n||l[1]!==i?(a=(0,s.jsxs)("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700",children:[i,n]}),l[0]=n,l[1]=i,l[2]=a):a=l[2],a}e.s(["default",()=>r])}]);